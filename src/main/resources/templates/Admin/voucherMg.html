<!DOCTYPE html>
<html>

<head th:replace="Admin/Layout/admin_layout :: cssAdmin">

</head>
<link rel="stylesheet" href="/admin/vendors/simple-datatables/style.css">

<body>
	<div th:replace="Admin/Layout/admin_layout :: sidebarAdmin"></div>
	<div id="main">
		<nav th:replace="Admin/Layout/admin_layout :: navbarAdmin"></nav>

		<!-- insert -->
		<div class="modal fade text-left" id="default" tabindex="-1" role="dialog" aria-labelledby="myModalLabel1"
			aria-hidden="true">
			<div class="modal-dialog modal-dialog-scrollable" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title" id="myModalLabel1">New voucher</h5>
						<button type="reset" class="close rounded-pill" data-bs-dismiss="modal" aria-label="Close">
							<i data-feather="x"></i>
						</button>
					</div>
					<form id="insertVoucher" name="insertVoucher" method="post" action="/Admin/insert-voucher">
						<div class="modal-body">
							<div class="form-group">
								<label for="basicInput">Coupon code</label>
								<input type="text" oncontextmenu="return false" class="form-control validateSpecialChar"
									id="id" name="id" maxlength="20" placeholder="Enter coupon code" autocomplete="off"
									required>
							</div>
							<div class="form-group">
								<label for="basicInput">Condition of order value must reach</label>
							</div>
							<div class="input-group mb-3">
								<span class="input-group-text">$</span>
								<input type="number" class="form-control" id="condition" name="condition" min="1"
									aria-label="Amount (to the nearest dollar)"
									placeholder="Condition of order value must reach" required>
							</div>
							<div class="form-group">
								<label for="basicInput">Discount</label>
							</div>
							<div class="input-group mb-3">
								<span class="input-group-text">$</span>
								<input type="number" class="form-control" id="discount" name="discount" min="1"
									aria-label="Amount (to the nearest dollar)" placeholder="Discount" required>
							</div>
							<div class="row">
								<div class="col-md-6">
									<div class="form-group">
										<label for="basicInput">Start Date</label>
										<input type="date" id="startDate" name="startDate" class="form-control"
											required>
									</div>
								</div>
								<div class="col-md-6">
									<div class="form-group">
										<label for="basicInput">End Date</label>
										<input type="date" id="endDate" name="endDate" class="form-control" required>
									</div>
								</div>
							</div>
						</div>
						<div class="modal-footer">
							<button type="reset" id="closeDefault" class="btn" data-bs-dismiss="modal">
								<i class="bx bx-x d-block d-sm-none"></i>
								<span class="d-none d-sm-block">Close</span>
							</button>
							<button id="addVoucher" type="submit" class="btn btn-primary ml-1">
								<i class="bx bx-check d-block d-sm-none"></i>
								<span class="d-none d-sm-block">Add</span>
							</button>
						</div>
					</form>
				</div>
			</div>
		</div>

		<!-- edit -->
		<div class="modal fade text-left" id="defaultEdit" tabindex="-1" role="dialog" aria-labelledby="myModalLabel1"
			aria-hidden="true">
			<div class="modal-dialog modal-dialog-scrollable" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<h5 class="modal-title" id="myModalLabel1">Edit voucher</h5>
						<button type="reset" class="close rounded-pill" data-bs-dismiss="modal" aria-label="Close">
							<i data-feather="x"></i>
						</button>
					</div>
					<form id="formUpdateVoucher" onsubmit="return false">
						<div class="modal-body">
							<div class="form-group">
								<label for="basicInput">Coupon code</label>
								<input type="text" oncontextmenu="return false" class="form-control validateSpecialChar"
									id="idEdit" name="idEdit" maxlength="20" placeholder="Enter coupon code" required>
							</div>
							<div class="form-group">
								<label for="basicInput">Condition of order value must reach</label>
							</div>
							<div class="input-group mb-3">
								<span class="input-group-text">$</span>
								<input type="number" class="form-control" id="conditionEdit" name="conditionEdit"
									min="1" aria-label="Amount (to the nearest dollar)"
									placeholder="Condition of order value must reach" required>
							</div>
							<div class="form-group">
								<label for="basicInput">Discount</label>
							</div>
							<div class="input-group mb-3">
								<span class="input-group-text">$</span>
								<input type="number" class="form-control" id="discountEdit" name="discountEdit" min="1"
									aria-label="Amount (to the nearest dollar)" placeholder="Discount" required>
							</div>
							<div class="row">
								<div class="col-md-6">
									<div class="form-group">
										<label for="basicInput">Start Date</label>
										<input type="date" id="startDateEdit" name="startDateEdit" class="form-control"
											required>
									</div>
								</div>
								<div class="col-md-6">
									<div class="form-group">
										<label for="basicInput">End Date</label>
										<input type="date" id="endDateEdit" name="endDateEdit" class="form-control"
											required>
									</div>
								</div>
							</div>
						</div>
						<div class="modal-footer">
							<button type="reset" id="closeDefaultEdit" class="btn" data-bs-dismiss="modal">
								<i class="bx bx-x d-block d-sm-none"></i>
								<span class="d-none d-sm-block">Close</span>
							</button>
							<button id="editVoucher" type="button" class="btn btn-primary ml-1">
								<i class="bx bx-check d-block d-sm-none"></i>
								<span class="d-none d-sm-block">Update</span>
							</button>
						</div>
					</form>
				</div>
			</div>
		</div>
		<!-- delete -->
		<div class="modal text-left" id="animation" tabindex="-1" role="dialog" aria-labelledby="myModalLabel6"
			aria-hidden="true">
			<div class="modal-dialog modal-dialog-centered modal-dialog-scrollable" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<h4 class="modal-title" id="myModalLabelBtn"></h4>
						<button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
							<i data-feather="x"></i>
						</button>
					</div>
					<div class="modal-body">
						<div class="alert bg-rgba-success" role="alert">
							<span class="text-bold-600" id="messBtn"></span>
						</div>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-light-secondary" data-bs-dismiss="modal">
							<i class="bx bx-x d-block d-sm-none"></i>
							<span class="d-none d-sm-block">Close</span>
						</button>
						<form method="post" action="/Admin/delete-voucher">
							<input hidden id="idVoucher" name="idVoucher">
							<input hidden id="isActive" name="isActive">
							<button type="submit" class="btn btn-primary ml-1" data-bs-dismiss="modal">
								<i class="bx bx-check d-block d-sm-none"></i>
								<span class="d-none d-sm-block" id="btnSubmit"></span>
							</button>
						</form>
					</div>
				</div>
			</div>
		</div>
		<!--end-->
		<div class="modal text-left" id="animationEnd" tabindex="-1" role="dialog" aria-labelledby="myModalLabel6"
			aria-hidden="true">
			<div class="modal-dialog modal-dialog-centered modal-dialog-scrollable" role="document">
				<div class="modal-content">
					<div class="modal-header">
						<h4 class="modal-title" id="myModalLabelBtnEnd"></h4>
						<button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
							<i data-feather="x"></i>
						</button>
					</div>
					<div class="modal-body">
						<div class="alert bg-rgba-success" role="alert">
							<span class="text-bold-600" id="messBtnEnd"></span>
						</div>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-light-secondary" data-bs-dismiss="modal">
							<i class="bx bx-x d-block d-sm-none"></i>
							<span class="d-none d-sm-block">Close</span>
						</button>
						<form method="post" action="/Admin/active-voucher">
							<input hidden id="idVoucherEnd" name="idVoucherEnd">
							<input hidden id="conditionEnd" name="conditionEnd">
							<input hidden id="discountEnd" name="discountEnd">
							<input hidden id="startDateEnd" name="startDateEnd">
							<input hidden id="isActiveEnd" name="isActiveEnd">
							<button type="submit" class="btn btn-primary ml-1" data-bs-dismiss="modal">
								<i class="bx bx-check d-block d-sm-none"></i>
								<span class="d-none d-sm-block" id="btnSubmitEnd"></span>
							</button>
						</form>
					</div>
				</div>
			</div>
		</div>

		<div class="main-content container-fluid">
			<div class="page-title">
				<div class="row">
					<div class="col-12 col-md-6 order-md-1 order-last">
						<h3>Voucher Management</h3>
					</div>
					<div class="col-12 col-md-6 order-md-2 order-first">
						<nav aria-label="breadcrumb" class='breadcrumb-header'>
							<ol class="breadcrumb">
								<li class="breadcrumb-item"><a href="/Admin/dashboard">Dashboard</a></li>
								<li class="breadcrumb-item active" aria-current="page">Voucher Management</li>
							</ol>
						</nav>
					</div>
				</div>
			</div>
			<section class="section">
				<div class="card">
					<div class="card-body">
						<div class="row">
							<div class="col-md-6 mb-4">
								<button type="button" class="btn btn-primary" data-bs-toggle="modal"
									data-bs-target="#default">
									New Voucher
								</button>
							</div>
							<div class="col-md-6 mb-4">
								<div class="input-group mb-3">
									<label class="input-group-text" for="inputGroupSelect01">Options</label>
									<select class="form-select" id="optVoucher">
										<option value="allVou" select>All Voucher</option>
										<option value="0">Upcoming</option>
										<option value="1">Happening</option>
										<option value="2">Finished</option>
									</select>
								</div>
							</div>
						</div>
						<div id="tableVoucher">
							<table class='table table-striped' id="table1">
								<thead>
									<tr>
										<th>Coupon Code</th>
										<th>Name</th>
										<th>Start Date</th>
										<th>End Date</th>
										<th>Status</th>
									</tr>
								</thead>
								<tbody>
									<th:block th:each="item: ${lstVou}">
										<tr>
											<td th:text="${item.id}"></td>
											<td hidden th:text="${item.condition}"></td>
											<td hidden th:text="${item.discount}"></td>
											<td>
												Order enough <span th:text="${item.condition}"></span>$ to get <span
													th:text="${item.discount}"></span>$ off
											</td>
											<td th:text="${item.startDate}"></td>
											<td th:text="${item.endDate}"></td>
											<td th:switch="${item.isActive}">
												<th:block th:case="0">
													<button type="button" id="btnEdit" class="btn btn-outline-success"
														data-bs-toggle="modal" data-bs-target="#defaultEdit">
														Edit
													</button>
													<button type="button" id="btnDlt" class="btn btn-outline-danger"
														data-bs-toggle="modal" data-bs-target="#animation">
														Delete
													</button>
												</th:block>
												<button th:case="1" id="finishNow" type="button"
													class="btn btn-outline-danger" data-bs-toggle="modal"
													data-bs-target="#animationEnd">
													End immediately
												</button>
												<span th:case="2" style="color: darkblue;">Finished</span>
											</td>
										</tr>
									</th:block>
								</tbody>
							</table>
						</div>


					</div>
				</div>

			</section>
		</div>
		<footer th:replace="Admin/Layout/admin_layout :: footerAdmin"></footer>
	</div>

	<div th:replace="Admin/Layout/admin_layout :: scriptAdmin"></div>

	<script src="/admin/vendors/simple-datatables/simple-datatables.js"></script>
	<script src="/admin/js/vendors.js"></script>
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.4/jquery.min.js"></script>
	<script>
		var field = document.querySelector('[name="id"]');
		field.addEventListener('keypress', function (event) {
			var key = event.keyCode;
			if (key === 32) {
				event.preventDefault();
			}
		});
		jQuery('[name="id"]').bind('cut copy paste', function (e) { // vô hiệu hóa trên 1 thẻ được chỉ định ID
			e.preventDefault(); return false;
		});

		var field = document.querySelector('[name="idEdit"]');
		field.addEventListener('keypress', function (event) {
			var key = event.keyCode;
			if (key === 32) {
				event.preventDefault();
			}
		});
		jQuery('[name="idEdit"]').bind('cut copy paste', function (e) { // vô hiệu hóa trên 1 thẻ được chỉ định ID
			e.preventDefault(); return false;
		});

		let validateSpecialChars;
		try {
			validateSpecialChars = document.querySelectorAll(".validateSpecialChar");
		} catch (error) { }
		if (validateSpecialChars !== undefined) {
			validateSpecialChars.forEach(function (element) {
				element.addEventListener("keypress", function (event) {
					var regex = new RegExp("^[a-zA-Z0-9]+$");
					var key = String.fromCharCode(!event.charCode ? event.which : event.charCode);
					if (!regex.test(key)) {
						event.preventDefault();
						return false;
					}
				});

				element.addEventListener("blur", function (e) {
					element.value = element.value.trim();
				});

				element.addEventListener("paste", function (e) {
					e.preventDefault();
				});

				element.addEventListener("drop", function (e) {
					e.preventDefault();
				});
				element.addEventListener("input", function (e) {
					element.value = element.value.replace(/[^a-zA-Z0-9 ]/gm, '');
				}, false);

				element.addEventListener("paste", function (e) {
					element.value = element.value.replace(/[^a-zA-Z0-9 ]/gm, '');
				}, false);
			});

		}


		$('#addVoucher').click(function (e) {
			e.preventDefault();
			var check = true;
			if ($('#id').val().trim() == "") {
				check = false;
				document.querySelector('input[name="id"]').setCustomValidity("Please enter complete information (with characters).");
				document.querySelector('input[name="id"]').reportValidity();
			} else if ($('#id').val().trim() != "") {
				var checkTitle = true;
				$.ajax({
					type: "Get",
					url: "/Admin/checkVoucher?idVoucher=" + $('#id').val().trim(),
					success: function (res) {
						//alert(res);
						if (res) {
							checkTitle = false;
							if (checkTitle == false) {
								document.querySelector('input[name="id"]').setCustomValidity("The coupon code already exist.");
								document.querySelector('input[name="id"]').reportValidity();
								return false;
							}
						}
						if (document.querySelector('input[name="condition"]').value == "" || document.querySelector('input[name="condition"]').checkValidity() == false) {
							check = false;
							//document.querySelector('input[name="condition"]').setCustomValidity("Please fill in this field.");
							document.querySelector('input[name="condition"]').reportValidity();
							return false;
						}

						if (parseInt(document.querySelector('input[name="discount"]').value) > parseInt(document.querySelector('input[name="condition"]').value)) {
							check = false;
							document.querySelector('input[name="discount"]').setCustomValidity("The discount must be lower than the condition.");
							document.querySelector('input[name="discount"]').reportValidity();
							return false;
						}

						if (document.querySelector('input[name="discount"]').value == "") {
							check = false;
							//document.querySelector('input[name="discount"]').setCustomValidity("Please fill in this field.");
							document.querySelector('input[name="discount"]').reportValidity();
							return false;
						}

						if (!document.querySelector('input[name="startDate"]').checkValidity()) {
							check = false;
							document.querySelector('input[name="startDate"]').reportValidity();
							return false;
						}
						if (!document.querySelector('input[name="endDate"]').checkValidity()) {
							check = false;
							document.querySelector('input[name="endDate"]').reportValidity();
							return false;
						}
						if (parseInt(document.querySelector('input[name="discount"]').value) > (parseInt(document.querySelector('input[name="condition"]').value) / 2)) {
							flag = false;
							discount.setCustomValidity("Condition amount cannot be reduced by more than 50%");
							discount.reportValidity();
							return false;
						}

						if (check) {
							document.querySelector('form[name="insertVoucher"]').submit();
						}

					},
					error: function (response) {
						console.log(response.responseText);
					}
				});
			}
		});


		$("#optVoucher").on('change', function () {
			if ($("#optVoucher").val() == "0") {
				$.ajax({
					type: "Get",
					url: "/Admin/filter1",  //remember change the controller to your owns.
					success: function (data) {
						$("#tableVoucher").html("");
						$("#tableVoucher").html(data);
						let table1 = document.querySelector('#table1');
						let dataTableSupp = new simpleDatatables.DataTable(table1);
					},
					error: function (response) {
						console.log(response.responseText);
					}
				});
			} else if ($("#optVoucher").val() == "1") {
				$.ajax({
					type: "Get",
					url: "/Admin/filter2",  //remember change the controller to your owns.
					success: function (data) {
						$("#tableVoucher").html("");
						$("#tableVoucher").html(data);
						let table1 = document.querySelector('#table1');
						let dataTableSupp = new simpleDatatables.DataTable(table1);
					},
					error: function (response) {
						console.log(response.responseText);
					}
				});
			} else if ($("#optVoucher").val() == "2") {
				$.ajax({
					type: "Get",
					url: "/Admin/filter3",  //remember change the controller to your owns.
					success: function (data) {
						$("#tableVoucher").html("");
						$("#tableVoucher").html(data);
						let table1 = document.querySelector('#table1');
						let dataTableSupp = new simpleDatatables.DataTable(table1);
					},
					error: function (response) {
						console.log(response.responseText);
					}
				});
			} else {
				window.location = 'http://localhost:8080/Admin/voucher-management';
			}
		});

		$(document).ready(function () {
			$("#idEdit").prop('disabled', true);
			var check = true;
			document.getElementById('editVoucher').onclick = function () {
				if ($('#idEdit').val().trim() == "") {
					alert("Please enter complete information (with characters).");
				} else {
					if (document.querySelector('input[name="conditionEdit"]').value == "" || document.querySelector('input[name="conditionEdit"]').checkValidity() == false) {
						check = false;
						//document.querySelector('input[name="condition"]').setCustomValidity("Please fill in this field.");
						document.querySelector('input[name="conditionEdit"]').reportValidity();
						return false;
					}

					if (parseInt(document.querySelector('input[name="discountEdit"]').value) > parseInt(document.querySelector('input[name="conditionEdit"]').value)) {
						check = false;
						document.querySelector('input[name="discountEdit"]').setCustomValidity("The discount must be lower than the condition.");
						document.querySelector('input[name="discountEdit"]').reportValidity();
						return false;
					}

					if (document.querySelector('input[name="discountEdit"]').value == "") {
						check = false;
						//document.querySelector('input[name="discount"]').setCustomValidity("Please fill in this field.");
						document.querySelector('input[name="discountEdit"]').reportValidity();
						return false;
					}

					if (!document.querySelector('input[name="startDateEdit"]').checkValidity()) {
						check = false;
						document.querySelector('input[name="startDateEdit"]').reportValidity();
						return false;
					}
					if (!document.querySelector('input[name="endDateEdit"]').checkValidity()) {
						check = false;
						document.querySelector('input[name="endDateEdit"]').reportValidity();
						return false;
					}
					if (parseInt(document.querySelector('input[name="discountEdit"]').value) > (parseInt(document.querySelector('input[name="conditionEdit"]').value) / 2)) {
						flag = false;
						document.querySelector('input[name="discountEdit"]').setCustomValidity("Condition amount cannot be reduced by more than 50%");
						document.querySelector('input[name="discountEdit"]').reportValidity();
						return false;
					}
					if (check) {

						$.ajax({
							type: "Post",
							url: "/Admin/update-voucher",  //remember change the controller to your owns.
							data: {
								idEdit: $("#idEdit").val(),
								conditionEdit: $("#conditionEdit").val(),
								discountEdit: $("#discountEdit").val(),
								startDateEdit: $("#startDateEdit").val(),
								endDateEdit: $("#endDateEdit").val(),
							},
							success: function (res) {

								$("#tableVoucher").html("");
								$("#tableVoucher").html(res);
								let table1 = document.querySelector('#table1');
								let dataTableSupp = new simpleDatatables.DataTable(table1);
								$('#closeDefaultEdit').click();
							},
							error: function (response) {
								console.log(response.responseText);
							}
						});
					}
				}
			};

			$("#table1").on('click', '#btnDlt', function () {
				var currentRow = $(this).closest("tr");

				var idVou = currentRow.find("td:eq(0)").text();
				$("#idVoucher").val(idVou);
				$("#isActive").val(0);
				$("#myModalLabelBtn").text("Delete Voucher");
				$("#messBtn").text("Are you sure you want to delete this voucher?");
				$("#btnSubmit").text("Delete");

			});

			$("#table1").on('click', '#btnEdit', function () {
				var currentRow = $(this).closest("tr");

				var idVou = currentRow.find("td:eq(0)").text();
				var condition = currentRow.find("td:eq(1)").text();
				var discount = currentRow.find("td:eq(2)").text();
				var startDate = currentRow.find("td:eq(4)").text();
				var endDate = currentRow.find("td:eq(5)").text();

				$("#idEdit").val(idVou);
				$("#conditionEdit").val(condition);
				$("#discountEdit").val(discount);
				$("#startDateEdit").val(startDate);
				var date = new Date(startDate.replace(/(\d{2})-(\d{2})-(\d{4})/, "$2/$1/$3"));
				date.setDate(date.getDate() + 1);
				var minEndEdit = date.getFullYear() + "-" + (date.getMonth() + 1) + "-" + date.getDate();
				$("#endDateEdit").attr('min', minEndEdit);
				$("#endDateEdit").val(endDate);
				$("#discountEdit").attr({
					"max": condition
				});
				$('#conditionEdit').on('blur', function (e) {
					$("#discountEdit").attr({
						"max": $("#conditionEdit").val()
					});
				});

			});
			$("#table1").on('click', '#finishNow', function () {
				var currentRow = $(this).closest("tr");

				var idVou = currentRow.find("td:eq(0)").text();
				var condition = currentRow.find("td:eq(1)").text();
				var discount = currentRow.find("td:eq(2)").text();
				var startDate = currentRow.find("td:eq(4)").text();
				$("#idVoucherEnd").val(idVou);
				$("#conditionEnd").val(condition);
				$("#discountEnd").val(discount);
				$("#startDateEnd").val(startDate);
				$("#isActiveEnd").val(2);
				$("#myModalLabelBtnEnd").text("End Immediately");
				$("#messBtnEnd").text("Are you sure you want to end this voucher?");
				$("#btnSubmitEnd").text("Finished");
			});
		});
	</script>
	<script type="module">

		$('#condition').on('blur', function (e) {
			$("#discount").attr({
				"max": $('#condition').val()
			});
		});
		//OnLoad
		var currentDate = new Date();
		var minForStart = currentDate.getFullYear() + "-" + (currentDate.getMonth() + 1) + "-" + (currentDate.getDate() + 1);
		//
		var nextCurrentDate = currentDate;
		nextCurrentDate.setDate(nextCurrentDate.getDate() + 2)
		var minForEnd = nextCurrentDate.getFullYear() + "-" + (nextCurrentDate.getMonth() + 1) + "-" + nextCurrentDate.getDate();
		onLoadValidateDate();

		$("#startDateEdit").attr('min', formatDate(minForStart));

		function onLoadValidateDate() {
			//Common Set MinStart Store Value
			$("#startDate").attr('min', formatDate(minForStart));
			$("#startDate").val(formatDate(minForStart));
			$("#endDate").attr('min', formatDate(minForEnd));
			$("#endDate").val(formatDate(minForEnd));
		}


		$('#startDateEdit').on('blur', function (e) {
			e.preventDefault();
			const distanceDate = 25;
			//
			onDoneCheckYears($(this))
			if (new Date($(this).val()) < new Date($(this).attr('min'))) {
				$(this).val(formatDate(minForStart));
				//Derived
				$('#endDateEdit').attr('min', formatDate(minForEnd));
				$('#endDateEdit').val($('#endDateEdit').attr('min'));
			} else if (new Date($(this).val()) >= new Date($(this).attr('min'))) {
				var newLocalDate = new Date($(this).val());
				var newNextLocalDate = newLocalDate;
				newNextLocalDate.setDate(newNextLocalDate.getDate() + 1);
				var newMinForEnd = formatDate(newNextLocalDate);
				$('#endDateEdit').attr('min', newMinForEnd);
				if (new Date($(this).val()) >= new Date($('#endDateEdit').val())) {
					$('#endDateEdit').val(newMinForEnd);
				}
			}
		});

		$('#endDateEdit').on('blur', function (e) {
			e.preventDefault();
			if (new Date($(this).val()) < new Date($(this).attr('min'))) {
				$(this).val($(this).attr('min'));
			} else {
				onDoneCheckYears($(this))
			}
		})

		$('#startDate').on('blur', function (e) {
			e.preventDefault();
			const distanceDate = 25;
			//
			onDoneCheckYears($(this))
			if (new Date($(this).val()) < new Date($(this).attr('min'))) {
				$(this).val(minForStart);
				//Derived
				$('#endDate').attr('min', minForEnd);
				$('#endDate').val($('#endDate').attr('min'));
			} else if (new Date($(this).val()) >= new Date($(this).attr('min'))) {
				var newLocalDate = new Date($(this).val());
				var newNextLocalDate = newLocalDate;
				newNextLocalDate.setDate(newNextLocalDate.getDate() + 1);
				var newMinForEnd = formatDate(newNextLocalDate);
				$('#endDate').attr('min', newMinForEnd);
				if (new Date($(this).val()) >= new Date($('#endDate').val())) {
					$('#endDate').val(newMinForEnd);
				}
			}
		});

		//When Clicking Clear
		$('input[type="date"]').on('change', function (e) {
			e.preventDefault();
			if ($(this).val().trim().length == 0) {
				caseResetInputDate($(this));
			}
		});

		$('#endDate').on('blur', function (e) {
			e.preventDefault();
			if (new Date($(this).val()) < new Date($(this).attr('min'))) {
				$(this).val($(this).attr('min'));
			} else {
				onDoneCheckYears($(this))
			}
		})

		//Check LocalFormat
		function getLocalFormat() {
			var localDate = new Date();
			console.log(localDate.toLocaleDateString());
		}

		//Format Date To YYYY-MM-DD
		function formatDate(date) {
			var dateFormat = new Date(date),
				month = '' + (dateFormat.getMonth() + 1),
				day = '' + dateFormat.getDate(),
				year = dateFormat.getFullYear();

			if (month.length < 2)
				month = '0' + month;
			if (day.length < 2)
				day = '0' + day;

			return [year, month, day].join('-');
		}

		//Check Years
		function onDoneCheckYears(item) {
			var dateObjectInput = new Date($(item).val());
			var yearsCount = dateObjectInput.getFullYear();
			console.log(yearsCount);
			if (yearsCount < 2023 || yearsCount > 2050 || isNaN(yearsCount) == true) {
				caseResetInputDate($(item).attr('id'));
			}
		}

		//Recaculate DateTime
		function caseResetInputDate(fieldID) {
			switch (fieldID) {
				case 'startDate':
					$("#startDate").val(formatDate(minForStart));
					break;
				case 'endDate':
					$("#endDate").val(formatDate(minForEnd));
					break;
			}
		}
	</script>
</body>

</html>